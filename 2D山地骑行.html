<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>2D山地骑行游戏</title>
<style>
body { margin:0; overflow:hidden; background:#87ceeb; touch-action:none; }
#score { position:absolute; top:10px; left:10px; font-size:20px; color:#fff; z-index:10;}
.controls { position:absolute; bottom:10px; left:50%; transform:translateX(-50%); z-index:10;}
button { font-size:16px; padding:8px 12px; margin:5px; }
.virtual-btn { position:absolute; bottom:60px; width:60px; height:60px; font-size:24px; opacity:0.5; background:#000; color:#fff; border-radius:50%; text-align:center; line-height:60px; user-select:none; }
#leftBtn { left:30px; }
#rightBtn { right:30px; }
canvas { display:block; }
</style>
</head>
<body>
<div id="score">分数: 0</div>
<div class="controls">
  <button onclick="restartGame()">重新开始</button>
  <button onclick="exitGame()">退出游戏</button>
</div>
<div id="leftBtn" class="virtual-btn">◀</div>
<div id="rightBtn" class="virtual-btn">▶</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// 玩家小车固定在屏幕底部
let car = {x: canvas.width/2, y: canvas.height - 50, width:40, height:20};
let keys = {left:false, right:false};
let obstacles = [];
let score = 0;
let gameOver = false;

// 键盘控制
document.addEventListener('keydown', e=>{
  if(e.key==='ArrowLeft'||e.key==='a') keys.left=true;
  if(e.key==='ArrowRight'||e.key==='d') keys.right=true;
});
document.addEventListener('keyup', e=>{
  if(e.key==='ArrowLeft'||e.key==='a') keys.left=false;
  if(e.key==='ArrowRight'||e.key==='d') keys.right=false;
});

// 手机虚拟按键
const leftBtn = document.getElementById('leftBtn');
const rightBtn = document.getElementById('rightBtn');
leftBtn.addEventListener('touchstart', ()=>{ keys.left=true; });
leftBtn.addEventListener('touchend', ()=>{ keys.left=false; });
rightBtn.addEventListener('touchstart', ()=>{ keys.right=true; });
rightBtn.addEventListener('touchend', ()=>{ keys.right=false; });

// 生成障碍物
function createObstacle(){
  const x = Math.random()*(canvas.width-40)+20;
  obstacles.push({x:x, y:0, width:30, height:20});
}

// 重新开始
function restartGame(){
  if(confirm("是否重新开始游戏？")){
    obstacles=[];
    car.x = canvas.width/2;
    score = 0;
    gameOver = false;
    document.getElementById('score').innerText = "分数: 0";
  }
}

// 退出游戏
function exitGame(){
  if(confirm("是否退出游戏？")){
    gameOver = true;
    alert("游戏已退出！");
    window.close();
    setTimeout(()=>{ location.reload(); },200);
  }
}

// 更新游戏
function update(){
  if(gameOver) return;

  if(keys.left) car.x -= 5;
  if(keys.right) car.x += 5;
  if(car.x < 20) car.x = 20;
  if(car.x > canvas.width - 20) car.x = canvas.width - 20;

  if(Math.random()<0.02) createObstacle();

  for(let i=0;i<obstacles.length;i++){
    obstacles[i].y += 5;
    // 碰撞检测
    if(obstacles[i].y + obstacles[i].height > car.y &&
       obstacles[i].y < car.y + car.height &&
       obstacles[i].x + obstacles[i].width > car.x - car.width/2 &&
       obstacles[i].x < car.x + car.width/2){
      gameOver = true;
      alert("游戏结束! 得分: "+score);
    }
    if(!gameOver && obstacles[i].y > canvas.height){
      score++;
      document.getElementById('score').innerText = "分数: "+score;
    }
  }
  obstacles = obstacles.filter(o=>o.y < canvas.height + 20);
}

// 绘制
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // 绘制地面
  ctx.fillStyle="#654321";
  ctx.fillRect(0, canvas.height - 40, canvas.width, 40);

  // 玩家小车
  ctx.fillStyle="green";
  ctx.fillRect(car.x - car.width/2, car.y, car.width, car.height);

  // 障碍物
  ctx.fillStyle="red";
  for(let o of obstacles){
    ctx.fillRect(o.x, o.y, o.width, o.height);
  }
}

// 游戏循环
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>

